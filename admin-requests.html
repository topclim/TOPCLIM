<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة تحكم الطلبات</title>
  <style>/* 📁 assets/style.css – الجزء الثاني من المشروع */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Cairo', sans-serif;
}

body {
  background-color: #f4f7fa;
  color: #333;
}

.header {
  background-color: #007bff;
  padding: 20px;
  color: white;
  text-align: center;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
}

.header input[type="search"] {
  margin-top: 10px;
  padding: 10px;
  width: 60%;
  border: none;
  border-radius: 5px;
  font-size: 16px;
}

.dashboard {
  padding: 30px 20px;
  max-width: 1200px;
  margin: auto;
}

.summary-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  justify-content: space-around;
  margin-bottom: 30px;
}

.card {
  background-color: #fff;
  padding: 15px 25px;
  border-radius: 10px;
  min-width: 150px;
  text-align: center;
  font-weight: bold;
  color: #007bff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  cursor: pointer;
  transition: 0.2s;
}

.card span {
  display: block;
  font-size: 24px;
  margin-top: 10px;
  color: #222;
}

.card:hover {
  background-color: #007bff;
  color: white;
}

.filters {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
}

.filters button {
  padding: 10px 20px;
  border: none;
  background: #e0e0e0;
  border-radius: 5px;
  cursor: pointer;
}

.filters button:hover {
  background-color: #007bff;
  color: white;
}

.toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 10px;
}

.toolbar select, .toolbar button {
  padding: 10px;
  border-radius: 5px;
  border: 1px solid #ccc;
}

.toolbar .add-order {
  background-color: #28a745;
  color: white;
  border: none;
}

.orders-list table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.orders-list th, .orders-list td {
  padding: 12px 10px;
  text-align: center;
  border-bottom: 1px solid #eee;
}

.orders-list th {
  background-color: #007bff;
  color: white;
}
</style>
</head>
<body>
  <header class="header">
    <h1>إدارة الطلبات</h1>
    <input type="search" placeholder="...البحث عن طلبية">
  </header>
  <main class="dashboard">
    <section class="summary-cards">
      <div class="card total">الكل <span>0</span></div>
      <div class="card new">جديد <span>0</span></div>
      <div class="card pending">قيد التأكيد <span>0</span></div>
      <div class="card confirmed">مؤكدة <span>0</span></div>
      <div class="card delivery">عند شركة التوصيل <span>0</span></div>
      <div class="card done">مكتملة <span>0</span></div>
      <div class="card failed">ملغي <span>0</span></div>
      <div class="card deleted">محذوفة <span>0</span></div>
    </section>
    <section class="filters">
      <button>اليوم</button>
      <button>7 أيام</button>
      <button>شهر</button>
    </section>
    <section class="toolbar">
      <button class="add-order">إضافة طلب جديد +</button>
      <select>
        <option>10 طلبات</option>
        <option>20 طلب</option>
        <option>50 طلب</option>
      </select>
      <select>
        <option>اختر المنتجات</option>
      </select>
    </section>
    <section class="orders-list">
      <table>
        <thead>
          <tr>
            <th>الطلب</th>
            <th>الاسم</th>
            <th>العنوان</th>
            <th>الهاتف</th>
            <th>الحالة</th>
            <th>الإجراءات</th>
          </tr>
        </thead>
        <tbody id="orders-body">
          <!-- الطلبات تُدرج هنا ديناميكياً -->
        </tbody>
      </table>
    </section>
  </main>
  <footer>
    Foorweb, Inc 2022-2025 ©
  </footer>

  <script type="module" >// 📁 public/app.js – الجزء الثالث من المشروع
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  updateDoc,
  deleteDoc,
  doc,
  Timestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// إعداد Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBjbzbSd1XM9eyXrgKaVj6xnZgIJuQmbRI",
  authDomain: "topclim-3edfa.firebaseapp.com",
  projectId: "topclim-3edfa"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// 🗂️ العناصر
const ordersTable = document.querySelector("#ordersTable tbody");
const searchInput = document.querySelector("#searchInput");

let allOrders = [];

// 📥 تحميل الطلبات
async function fetchOrders() {
  const snapshot = await getDocs(collection(db, "requests"));
  allOrders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  renderOrders(allOrders);
}

function renderOrders(list) {
  ordersTable.innerHTML = "";

  if (list.length === 0) {
    ordersTable.innerHTML = "<tr><td colspan='7'>🚫 لا توجد طلبات</td></tr>";
    return;
  }

  for (const order of list) {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${order.id}</td>
      <td>${order.name || "—"}</td>
      <td>${order.phone || "—"}</td>
      <td>${order.status || "مبدئي"}</td>
      <td>${order.address || "—"}</td>
      <td><button class="view-btn" data-id="${order.id}">📄 تفاصيل</button></td>
      <td><button class="delete-btn" data-id="${order.id}">🗑️ حذف</button></td>
    `;

    ordersTable.appendChild(tr);
  }

  addActionListeners();
}

function addActionListeners() {
  document.querySelectorAll(".view-btn").forEach(btn => {
    btn.onclick = () => {
      const id = btn.dataset.id;
      window.location.href = `order-details.html?id=${id}`;
    };
  });

  document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.onclick = async () => {
      const id = btn.dataset.id;
      const confirmDelete = confirm("هل أنت متأكد من حذف هذا الطلب؟");
      if (!confirmDelete) return;

      await deleteDoc(doc(db, "requests", id));
      fetchOrders();
    };
  });
}

// 🔍 فلترة عبر البحث
searchInput.addEventListener("input", () => {
  const term = searchInput.value.trim().toLowerCase();
  const filtered = allOrders.filter(o =>
    (o.name || "").toLowerCase().includes(term) ||
    (o.phone || "").toLowerCase().includes(term) ||
    (o.address || "").toLowerCase().includes(term)
  );
  renderOrders(filtered);
});

fetchOrders();
</script>
</body>
</html>
