<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
  <style>/* ğŸ“ assets/style.css â€“ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ Ù…Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Cairo', sans-serif;
}

body {
  background-color: #f4f7fa;
  color: #333;
}

.header {
  background-color: #007bff;
  padding: 20px;
  color: white;
  text-align: center;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 1000;
}

.header input[type="search"] {
  margin-top: 10px;
  padding: 10px;
  width: 60%;
  border: none;
  border-radius: 5px;
  font-size: 16px;
}

.dashboard {
  padding: 30px 20px;
  max-width: 1200px;
  margin: auto;
}

.summary-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  justify-content: space-around;
  margin-bottom: 30px;
}

.card {
  background-color: #fff;
  padding: 15px 25px;
  border-radius: 10px;
  min-width: 150px;
  text-align: center;
  font-weight: bold;
  color: #007bff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  cursor: pointer;
  transition: 0.2s;
}

.card span {
  display: block;
  font-size: 24px;
  margin-top: 10px;
  color: #222;
}

.card:hover {
  background-color: #007bff;
  color: white;
}

.filters {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
}

.filters button {
  padding: 10px 20px;
  border: none;
  background: #e0e0e0;
  border-radius: 5px;
  cursor: pointer;
}

.filters button:hover {
  background-color: #007bff;
  color: white;
}

.toolbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 10px;
}

.toolbar select, .toolbar button {
  padding: 10px;
  border-radius: 5px;
  border: 1px solid #ccc;
}

.toolbar .add-order {
  background-color: #28a745;
  color: white;
  border: none;
}

.orders-list table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.orders-list th, .orders-list td {
  padding: 12px 10px;
  text-align: center;
  border-bottom: 1px solid #eee;
}

.orders-list th {
  background-color: #007bff;
  color: white;
}
</style>
</head>
<body>
  <header class="header">
    <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
    <input type="search" placeholder="...Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø·Ù„Ø¨ÙŠØ©">
  </header>
  <main class="dashboard">
    <section class="summary-cards">
      <div class="card total">Ø§Ù„ÙƒÙ„ <span>0</span></div>
      <div class="card new">Ø¬Ø¯ÙŠØ¯ <span>0</span></div>
      <div class="card pending">Ù‚ÙŠØ¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯ <span>0</span></div>
      <div class="card confirmed">Ù…Ø¤ÙƒØ¯Ø© <span>0</span></div>
      <div class="card delivery">Ø¹Ù†Ø¯ Ø´Ø±ÙƒØ© Ø§Ù„ØªÙˆØµÙŠÙ„ <span>0</span></div>
      <div class="card done">Ù…ÙƒØªÙ…Ù„Ø© <span>0</span></div>
      <div class="card failed">Ù…Ù„ØºÙŠ <span>0</span></div>
      <div class="card deleted">Ù…Ø­Ø°ÙˆÙØ© <span>0</span></div>
    </section>
    <section class="filters">
      <button>Ø§Ù„ÙŠÙˆÙ…</button>
      <button>7 Ø£ÙŠØ§Ù…</button>
      <button>Ø´Ù‡Ø±</button>
    </section>
    <section class="toolbar">
      <button class="add-order">Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ +</button>
      <select>
        <option>10 Ø·Ù„Ø¨Ø§Øª</option>
        <option>20 Ø·Ù„Ø¨</option>
        <option>50 Ø·Ù„Ø¨</option>
      </select>
      <select>
        <option>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</option>
      </select>
    </section>
    <section class="orders-list">
      <table>
        <thead>
          <tr>
            <th>Ø§Ù„Ø·Ù„Ø¨</th>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="orders-body">
          <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØªÙØ¯Ø±Ø¬ Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </tbody>
      </table>
    </section>
  </main>
  <footer>
    Foorweb, Inc 2022-2025 Â©
  </footer>

  <script type="module" >// ğŸ“ public/app.js â€“ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù„Ø« Ù…Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  updateDoc,
  deleteDoc,
  doc,
  Timestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBjbzbSd1XM9eyXrgKaVj6xnZgIJuQmbRI",
  authDomain: "topclim-3edfa.firebaseapp.com",
  projectId: "topclim-3edfa"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ğŸ—‚ï¸ Ø§Ù„Ø¹Ù†Ø§ØµØ±
const ordersTable = document.querySelector("#ordersTable tbody");
const searchInput = document.querySelector("#searchInput");

let allOrders = [];

// ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
async function fetchOrders() {
  const snapshot = await getDocs(collection(db, "requests"));
  allOrders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  renderOrders(allOrders);
}

function renderOrders(list) {
  ordersTable.innerHTML = "";

  if (list.length === 0) {
    ordersTable.innerHTML = "<tr><td colspan='7'>ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>";
    return;
  }

  for (const order of list) {
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${order.id}</td>
      <td>${order.name || "â€”"}</td>
      <td>${order.phone || "â€”"}</td>
      <td>${order.status || "Ù…Ø¨Ø¯Ø¦ÙŠ"}</td>
      <td>${order.address || "â€”"}</td>
      <td><button class="view-btn" data-id="${order.id}">ğŸ“„ ØªÙØ§ØµÙŠÙ„</button></td>
      <td><button class="delete-btn" data-id="${order.id}">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>
    `;

    ordersTable.appendChild(tr);
  }

  addActionListeners();
}

function addActionListeners() {
  document.querySelectorAll(".view-btn").forEach(btn => {
    btn.onclick = () => {
      const id = btn.dataset.id;
      window.location.href = `order-details.html?id=${id}`;
    };
  });

  document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.onclick = async () => {
      const id = btn.dataset.id;
      const confirmDelete = confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ");
      if (!confirmDelete) return;

      await deleteDoc(doc(db, "requests", id));
      fetchOrders();
    };
  });
}

// ğŸ” ÙÙ„ØªØ±Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø­Ø«
searchInput.addEventListener("input", () => {
  const term = searchInput.value.trim().toLowerCase();
  const filtered = allOrders.filter(o =>
    (o.name || "").toLowerCase().includes(term) ||
    (o.phone || "").toLowerCase().includes(term) ||
    (o.address || "").toLowerCase().includes(term)
  );
  renderOrders(filtered);
});

fetchOrders();
</script>
</body>
</html>
