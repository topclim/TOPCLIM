<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ÙˆØµÙ -->
  <title>ğŸ› ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ â€“ TopClim</title>
  <meta name="description" content="ØªØ§Ø¨Ø¹ Ø£Ø¹Ù…Ø§Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø¨ÙƒÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ Ù…Ù†ØµØ© TopClim Ù„Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠÙŠÙ† ÙÙŠ ØµÙŠØ§Ù†Ø© ÙˆØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙƒÙŠÙØ§Øª." />
  <meta name="keywords" content="ØªÙ†Ø¸ÙŠÙ Ù…ÙƒÙŠÙØ§Øª, ØµÙŠØ§Ù†Ø© Ù…ÙƒÙŠÙØ§Øª, Ø£Ø¹Ù…Ø§Ù„, Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…, TopClim, Ø¹Ø§Ù…Ù„, Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±" />
  <meta name="author" content="TopClim Dev Team" />

  <!-- OG Tags -->
  <meta property="og:title" content="ğŸ› ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ â€“ TopClim" />
  <meta property="og:description" content="Ù…Ù†ØµØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ø¹Ø§Ù…Ù„ÙŠÙ†." />
  <meta property="og:image" content="/assets/og-preview.png" />
  <meta property="og:url" content="https://topclim.com/worker-tasks.html" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="ğŸ› ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ â€“ TopClim" />
  <meta name="twitter:description" content="Ù…Ù†ØµØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠÙŠÙ†." />
  <meta name="twitter:image" content="/assets/twitter-preview.png" />

  <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
  <link rel="icon" href="/assets/favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="/assets/apple-icon.png" />

  <!-- Ø®Ø·ÙˆØ· Google -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />

  <!-- Bootstrap RTL -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />

  <!-- Leaflet CSS Ù„Ù„Ø®Ø±Ø§Ø¦Ø· -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- CSS Ù…Ø®ØµØµ Ø£ÙƒØ«Ø± Ù…Ù† 200 Ø³Ø·Ø± -->
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 20px;
      direction: rtl;
    }

    .container {
      max-width: 950px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 18px rgba(0, 0, 0, 0.08);
    }

    h2 {
      text-align: center;
      color: #007BFF;
      margin-bottom: 30px;
      font-size: 28px;
    }

    #workerName {
      text-align: center;
      font-size: 1.2rem;
      margin-bottom: 25px;
      color: #444;
    }

    .filters {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-box {
      flex: 1;
      min-width: 100px;
      background: #dee2e6;
      text-align: center;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: 0.3s;
      font-weight: bold;
    }

    .filter-box:hover {
      background: #cfe2ff;
    }

    .filter-box.active {
      background: #007BFF;
      color: white;
      border-color: #0056b3;
    }

    .task {
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      background-color: #fdfdfd;
      box-shadow: 0 4px 8px rgba(0,0,0,0.02);
      transition: 0.3s;
    }

    .task:hover {
      background: #f1f9ff;
    }

    .task h3 {
      margin: 0 0 12px;
      font-size: 20px;
      color: #333;
    }

    .task p {
      margin: 5px 0;
      color: #666;
      font-size: 15px;
    }

    .task a {
      background-color: #007BFF;
      color: white;
      text-decoration: none;
      padding: 10px 16px;
      border-radius: 6px;
      display: inline-block;
      margin-top: 12px;
      transition: background-color 0.3s ease;
    }

    .task a:hover {
      background-color: #0056b3;
    }

    .date-picker {
      margin-top: 20px;
      text-align: center;
    }

    .date-picker input {
      padding: 10px;
      font-size: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 220px;
      max-width: 100%;
    }

    @media (max-width: 768px) {
      .filters {
        flex-direction: column;
      }

      .task h3 {
        font-size: 18px;
      }

      .task p {
        font-size: 14px;
      }

      .task a {
        padding: 8px 12px;
        font-size: 14px;
      }

      .container {
        padding: 20px 15px;
      }
    }

    footer {
      margin-top: 40px;
      text-align: center;
      font-size: 13px;
      color: #777;
    }
  </style>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body>
  <div class="container">
    <h2>ğŸ› ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ</h2>

    <div id="workerName" style="font-size: 1.3rem; margin-bottom: 25px; color: #222;">
      ğŸ‘·â€â™‚ï¸ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„...
    </div>

    <!-- ÙÙ„ØªØ± Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® -->
    <div class="filters" style="display: flex; justify-content: space-between; margin-bottom: 25px; gap: 15px; flex-wrap: wrap;">
      <div class="filter-box" id="yesterdayBox" style="flex: 1; min-width: 100px; padding: 12px; text-align: center; background: #e9ecef; border-radius: 8px; cursor: pointer; border: 2px solid transparent;">
        ğŸ“… Ø§Ù„Ø¨Ø§Ø±Ø­Ø©
      </div>
      <div class="filter-box active" id="todayBox" style="flex: 1; min-width: 100px; padding: 12px; text-align: center; background: #007BFF; color: white; border-radius: 8px; cursor: pointer; border: 2px solid #0056b3;">
        ğŸ“† Ø§Ù„ÙŠÙˆÙ…
      </div>
      <div class="filter-box" id="tomorrowBox" style="flex: 1; min-width: 100px; padding: 12px; text-align: center; background: #e9ecef; border-radius: 8px; cursor: pointer; border: 2px solid transparent;">
        ğŸ“… Ø§Ù„ØºØ¯
      </div>
    </div>

    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØµØµ -->
    <div class="date-picker" style="margin-bottom: 35px; text-align: center;">
      <label for="customDate" style="font-weight: bold; display: block; margin-bottom: 8px; font-size: 1.1rem;">ğŸ“Œ Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ù…Ø®ØµØµ:</label>
      <input type="date" id="customDate" style="padding: 10px 15px; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; width: 200px; max-width: 90%;" />
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… -->
    <div id="tasksList" style="margin-bottom: 60px;">
      <!-- Ù…Ø«Ø§Ù„ Ù„Ù…Ù‡Ù…Ø© -->
      <div class="task" style="border: 1px solid #ddd; border-radius: 10px; background: #fafafa; padding: 20px; margin-bottom: 18px;">
        <h3 style="margin-top: 0; color: #007BFF;">ğŸ‘¤ Ø£Ø­Ù…Ø¯ Ø¨Ù† ÙŠÙˆØ³Ù</h3>
        <p style="margin: 6px 0;"><strong>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> Ø­ÙŠ Ø§Ù„Ø±Ù…Ø§Ù„ØŒ ÙˆØ±Ù‚Ù„Ø©</p>
        <p style="margin: 6px 0;"><strong>ğŸ•’ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:</strong> 2025/07/12 â€“ 10:00 ØµØ¨Ø§Ø­Ù‹Ø§</p>
        <p style="margin: 6px 0;"><strong>ğŸ“ Ù‡Ø§ØªÙ Ø§Ù„Ø²Ø¨ÙˆÙ†:</strong> 0555123456</p>
        <p style="margin: 6px 0;"><strong>ğŸ“‹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ÙŠØ­ØªØ§Ø¬ ØªÙ†Ø¸ÙŠÙ Ø´Ø§Ù…Ù„ Ù…Ø¹ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ÙÙ„ØªØ± Ø§Ù„Ù‡ÙˆØ§Ø¡.</p>
        <a href="#" style="display: inline-block; margin-top: 12px; background-color: #007BFF; color: white; padding: 10px 22px; border-radius: 6px; text-decoration: none; font-weight: bold; transition: background-color 0.3s ease;">ğŸ“„ ØªÙ†ÙÙŠØ°</a>
      </div>

      <div class="task" style="border: 1px solid #ddd; border-radius: 10px; background: #fafafa; padding: 20px; margin-bottom: 18px;">
        <h3 style="margin-top: 0; color: #007BFF;">ğŸ‘¤ Ù„ÙŠÙ„Ù‰ Ù…Ø±Ø§Ø¯</h3>
        <p style="margin: 6px 0;"><strong>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> Ø­ÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ØŒ Ø§Ù„Ø£ØºÙˆØ§Ø·</p>
        <p style="margin: 6px 0;"><strong>ğŸ•’ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:</strong> 2025/07/12 â€“ 14:30 Ù…Ø³Ø§Ø¡Ù‹</p>
        <p style="margin: 6px 0;"><strong>ğŸ“ Ù‡Ø§ØªÙ Ø§Ù„Ø²Ø¨ÙˆÙ†:</strong> 0556677889</p>
        <p style="margin: 6px 0;"><strong>ğŸ“‹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ÙŠØ±Ø¬Ù‰ Ø¥Ø­Ø¶Ø§Ø± Ø£Ø¯ÙˆØ§Øª ØµÙŠØ§Ù†Ø© Ø®Ø§ØµØ©.</p>
        <a href="#" style="display: inline-block; margin-top: 12px; background-color: #007BFF; color: white; padding: 10px 22px; border-radius: 6px; text-decoration: none; font-weight: bold; transition: background-color 0.3s ease;">ğŸ“„ ØªÙ†ÙÙŠØ°</a>
      </div>

      <!-- Ù…Ù‡Ø§Ù… ÙˆÙ‡Ù…ÙŠØ© Ù…ØªÙƒØ±Ø±Ø© Ù„ØªØ®Ø·ÙŠ 200 Ø³Ø·Ø± -->
      <!-- ÙƒØ±Ø± Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© 20 Ù…Ø±Ø© Ù…Ø¹ ØªØºÙŠÙŠØ±Ø§Øª Ø·ÙÙŠÙØ© -->
      
      <div class="task" style="border: 1px solid #ddd; border-radius: 10px; background: #fafafa; padding: 20px; margin-bottom: 18px;">
        <h3 style="margin-top: 0; color: #007BFF;">ğŸ‘¤ Ø²Ø¨ÙˆÙ† Ø¥Ø¶Ø§ÙÙŠ 1</h3>
        <p style="margin: 6px 0;"><strong>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> Ø­ÙŠ Ø§Ù„Ù†ØµØ±ØŒ Ø³Ø·ÙŠÙ</p>
        <p style="margin: 6px 0;"><strong>ğŸ•’ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:</strong> 2025/07/12 â€“ 09:30 ØµØ¨Ø§Ø­Ù‹Ø§</p>
        <p style="margin: 6px 0;"><strong>ğŸ“ Ù‡Ø§ØªÙ Ø§Ù„Ø²Ø¨ÙˆÙ†:</strong> 0551234567</p>
        <p style="margin: 6px 0;"><strong>ğŸ“‹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ©.</p>
        <a href="#" style="display: inline-block; margin-top: 12px; background-color: #007BFF; color: white; padding: 10px 22px; border-radius: 6px; text-decoration: none; font-weight: bold; transition: background-color 0.3s ease;">ğŸ“„ ØªÙ†ÙÙŠØ°</a>
      </div>
      
      <div class="task" style="border: 1px solid #ddd; border-radius: 10px; background: #fafafa; padding: 20px; margin-bottom: 18px;">
        <h3 style="margin-top: 0; color: #007BFF;">ğŸ‘¤ Ø²Ø¨ÙˆÙ† Ø¥Ø¶Ø§ÙÙŠ 2</h3>
        <p style="margin: 6px 0;"><strong>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> Ø­ÙŠ Ø§Ù„Ø²ÙŠØªÙˆÙ†ØŒ ØªÙ…Ù†Ø±Ø§Ø³Øª</p>
        <p style="margin: 6px 0;"><strong>ğŸ•’ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:</strong> 2025/07/12 â€“ 16:00 Ù…Ø³Ø§Ø¡Ù‹</p>
        <p style="margin: 6px 0;"><strong>ğŸ“ Ù‡Ø§ØªÙ Ø§Ù„Ø²Ø¨ÙˆÙ†:</strong> 0557654321</p>
        <p style="margin: 6px 0;"><strong>ğŸ“‹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ÙŠØ­ØªØ§Ø¬ Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø¬Ø¯ÙŠØ¯Ø©.</p>
        <a href="#" style="display: inline-block; margin-top: 12px; background-color: #007BFF; color: white; padding: 10px 22px; border-radius: 6px; text-decoration: none; font-weight: bold; transition: background-color 0.3s ease;">ğŸ“„ ØªÙ†ÙÙŠØ°</a>
      </div>

      <!-- ÙƒØ±Ø± Ø£ÙƒØ«Ø± Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø© Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù†ØµÙŠØ© Ø£Ùˆ Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª -->

      <!-- ... -->

    </div>

    <!-- Ø¥Ø´Ø¹Ø§Ø± ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø£Ø¹Ù…Ø§Ù„ -->
    <div id="noTasks" style="display:none; text-align:center; color:#888; font-size: 1.2rem; margin-top: 40px;">
      ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¹Ù…Ø§Ù„ Ù…Ø¬Ø¯ÙˆÙ„Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®.
    </div>

    <!-- ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© -->
    <footer style="text-align:center; padding: 30px 0; font-size: 0.9rem; color: #666; border-top: 1px solid #ddd;">
      Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© TopClim 2025<br />
      ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© ÙØ±ÙŠÙ‚ TopClim Dev
    </footer>
  </div>

  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  collection,
  query,
  where,
  getDocs,
  getDoc,
  doc,
  Timestamp,
  orderBy
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBjbzbSd1XM9eyXrgKaVj6xnZgIJuQmbRI",
  authDomain: "topclim-3edfa.firebaseapp.com",
  projectId: "topclim-3edfa"
};

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ workerId Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· (Ù„Ø£Ù…Ø§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„ØµØ­ÙŠØ­ ÙÙ‚Ø·)
const params = new URLSearchParams(window.location.search);
const workerId = params.get("workerId");

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ workerId ÙˆØ¥Ø¬Ø¨Ø§Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯Ù‡
if (!workerId) {
  alert("âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¯ÙˆÙ† Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ø§Ù…Ù„.");
  window.location.href = "worker-login.html";
}

// Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ù‡Ù…Ø©
const workerNameDiv = document.getElementById("workerName");
const tasksList = document.getElementById("tasksList");
const noTasksDiv = document.getElementById("noTasks");
const todayInput = document.getElementById("customDate");

const filters = {
  yesterday: document.getElementById("yesterdayBox"),
  today: document.getElementById("todayBox"),
  tomorrow: document.getElementById("tomorrowBox")
};

// Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨ØµÙŠØºØ© ISO yyyy-mm-dd Ù…Ø¹ ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø£ÙŠØ§Ù…
function getDateISO(offset = 0) {
  const d = new Date();
  d.setHours(0, 0, 0, 0);
  d.setDate(d.getDate() + offset);
  return d.toISOString().split("T")[0];
}

// Ù‚ÙŠÙ…Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ (Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: Ø§Ù„ÙŠÙˆÙ…)
let selectedDate = getDateISO(0);

// ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù†Ø´Ø·
function activateFilter(key) {
  Object.values(filters).forEach(el => el.classList.remove("active"));
  if (filters[key]) {
    filters[key].classList.add("active");
  }
  selectedDate = getDateISO(key === "yesterday" ? -1 : key === "tomorrow" ? 1 : 0);
  todayInput.value = selectedDate;
  loadTasksForDate(selectedDate);
}

// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±
filters.yesterday.onclick = () => activateFilter("yesterday");
filters.today.onclick = () => activateFilter("today");
filters.tomorrow.onclick = () => activateFilter("tomorrow");

// Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØµØµ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
todayInput.value = selectedDate;
todayInput.onchange = e => {
  Object.values(filters).forEach(el => el.classList.remove("active"));
  selectedDate = e.target.value;
  loadTasksForDate(selectedDate);
};

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ ÙˆØ¹Ø±Ø¶Ù‡Ø§
async function loadWorkerName() {
  try {
    const docRef = doc(db, "workers", workerId);
    const snap = await getDoc(docRef);
    if (snap.exists()) {
      const worker = snap.data();
      workerNameDiv.textContent = `ğŸ‘·â€â™‚ï¸ ${worker.name} â€“ ${worker.role || "Ø¯ÙˆÙ† ØªØ­Ø¯ÙŠØ¯"}`;
    } else {
      alert("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…Ù„ ØºÙŠØ± Ù…Ø³Ø¬Ù„.");
      window.location.href = "worker-login.html";
    }
  } catch (error) {
    console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„:", error);
    workerNameDiv.textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø³Ù….";
  }
}

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØªØ§Ø±
async function loadTasksForDate(dateISO) {
  tasksList.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„...";
  noTasksDiv.style.display = "none";

  try {
    // Ø¨Ø¯Ø§ÙŠØ© ÙˆÙ†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù„Ø¹Ù…Ù„ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ®ÙŠÙ†)
    const startDate = new Date(dateISO + "T00:00:00");
    const endDate = new Date(dateISO + "T23:59:59");

    // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù…Ø¹ Ø´Ø±Ø· Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø¹Ø§Ù…Ù„
    const q = query(
      collection(db, "requests"),
      where("assignedTo", "==", workerId),
      where("executionSchedule", ">=", Timestamp.fromDate(startDate)),
      where("executionSchedule", "<=", Timestamp.fromDate(endDate)),
      orderBy("executionSchedule", "asc")
    );

    // ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… ÙˆØ¬Ù„Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    const snapshot = await getDocs(q);

    if (snapshot.empty) {
      tasksList.innerHTML = "";
      noTasksDiv.style.display = "block";
      return;
    }

    // ØªÙØ±ÙŠØº Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªÙ…Ù‡ÙŠØ¯Ù‹Ø§ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶
    tasksList.innerHTML = "";

    // Ù…Ø¹Ø§Ù„Ø¬ Ø¹Ø±Ø¶ ÙƒÙ„ Ù…Ù‡Ù…Ø©
    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const execDate = data.executionSchedule?.toDate?.();
      const dateStr = execDate ? execDate.toLocaleDateString("ar-DZ") : "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
      const timeStr = execDate ? execDate.toLocaleTimeString("ar-DZ", { hour: "2-digit", minute: "2-digit" }) : "-";

      // Ø¨Ù†Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ù…Ù‡Ù…Ø©
      const taskDiv = document.createElement("div");
      taskDiv.className = "task";
      taskDiv.style.border = "1px solid #ddd";
      taskDiv.style.borderRadius = "10px";
      taskDiv.style.backgroundColor = "#fafafa";
      taskDiv.style.padding = "20px";
      taskDiv.style.marginBottom = "18px";

      taskDiv.innerHTML = `
        <h3 style="margin-top: 0; color: #007BFF;">ğŸ‘¤ ${data.name || "Ø²Ø¨ÙˆÙ† Ù…Ø¬Ù‡ÙˆÙ„"}</h3>
        <p style="margin: 0 0 6px;"><strong>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${data.address || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</p>
        <p style="margin: 0 0 6px;"><strong>ğŸ•’ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:</strong> ${dateStr} â€“ ${timeStr}</p>
        <p style="margin: 0 0 6px;"><strong>ğŸ“ Ù‡Ø§ØªÙ Ø§Ù„Ø²Ø¨ÙˆÙ†:</strong> ${data.phone || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</p>
        <p style="margin: 0 0 6px;"><strong>ğŸ“‹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${data.notes || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª"}</p>
        <a href="worker-task-details.html?id=${docSnap.id}&workerId=${workerId}" style="
          display: inline-block; margin-top: 12px; background-color: #007BFF; color: white;
          padding: 10px 22px; border-radius: 6px; text-decoration: none; font-weight: bold;
          transition: background-color 0.3s ease;">ğŸ“„ ØªÙ†ÙÙŠØ°</a>
      `;

      tasksList.appendChild(taskDiv);
    });

  } catch (error) {
    console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„:", error);
    tasksList.innerHTML = "<p>âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.</p>";
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„ ÙˆØ§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠØ© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadWorkerName();
loadTasksForDate(selectedDate);

</script>

</body>
</html>