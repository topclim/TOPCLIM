<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <!-- âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Ø§Ø­Ø¬Ø² Ø®Ø¯Ù…Ø© ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙƒÙŠÙØ§Øª ÙÙŠ Ø«ÙˆØ§Ù†Ù Ù…Ø¹ TopClim â€“ Ø¬ÙˆØ¯Ø©ØŒ Ø³Ø±Ø¹Ø©ØŒ ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ©." />
  <meta name="keywords" content="ØªÙ†Ø¸ÙŠÙ Ù…ÙƒÙŠÙØ§Øª, ØªÙˆØ¨ ÙƒÙ„ÙŠÙ…, ØµÙŠØ§Ù†Ø© ØªÙƒÙŠÙŠÙ, topclim" />
  <meta name="author" content="TopClim Team" />

  <!-- âœ… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
  <title>ØªÙ†Ø¸ÙŠÙ Ù…ÙƒÙŠÙØ§Øª â€“ TopClim</title>

  <!-- âœ… Ø§Ù„Ø®Ø·ÙˆØ· -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />
  
  <!-- âœ… Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
  <link rel="icon" type="image/png" href="favicon.png" />

  <!-- âœ… Ù…ÙƒØªØ¨Ø© Leaflet Ù„Ù„Ø®Ø±ÙŠØ·Ø© -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- âœ… ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS Ù…Ø®ØµØµØ© -->
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }

    header, footer {
      background-color: #007BFF;
      color: white;
      text-align: center;
      padding: 20px 10px;
    }

    section {
      padding: 20px;
    }

    h2 {
      color: #333;
      font-size: 24px;
      margin-bottom: 15px;
    }

    .before-after {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
    }

    .before-after img {
      width: 48%;
      margin-bottom: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transition: transform 0.3s ease;
    }

    .before-after img:hover {
      transform: scale(1.02);
    }

    form {
      background-color: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    form input,
    form select,
    form textarea,
    form button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    form input:focus,
    form select:focus,
    form textarea:focus {
      border-color: #007BFF;
      outline: none;
    }

    textarea {
      resize: vertical;
    }

    form button {
      background-color: #007BFF;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    form button:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }

    #map {
      height: 300px;
      border-radius: 10px;
      margin-top: 15px;
    }

    .note {
      color: green;
      font-weight: 500;
      margin-top: 10px;
    }

    #landingTitle {
      font-size: 30px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    #landingDesc {
      font-size: 18px;
      color: #e0e0e0;
    }

    #footerText {
      font-size: 14px;
    }

    #acContainer .ac-group {
      margin-bottom: 15px;
      background-color: #f1f1f1;
      padding: 10px;
      border-radius: 8px;
    }

    #acContainer .ac-group label {
      font-weight: bold;
      display: block;
      margin: 8px 0 5px;
    }

    /* âœ… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¤Ù‚ØªØ© */
    .flash-message {
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      background-color: #d4edda;
      color: #155724;
      display: none;
    }

    /* âœ… ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¬ÙˆØ§Ù„ */
    @media screen and (max-width: 600px) {
      .before-after img {
        width: 100%;
      }

      h2 {
        font-size: 20px;
      }

      form input,
      form select,
      form textarea,
      form button {
        font-size: 14px;
        padding: 10px;
      }
    }

    /* âœ… ØªØ®ØµÙŠØµ Ù†Øµ Ø§Ù„Ø¹Ù†ØµØ± placeholder */
    ::placeholder {
      color: #aaa;
      font-style: italic;
    }

    /* âœ… Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø®ÙÙŠÙ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    .fade-in {
      animation: fadeIn 1s ease-in-out;
    }

    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    /* âœ… Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
    .loading-btn::after {
      content: \" â³\";
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

  </style>

  <!-- âœ… Ù…ÙƒØªØ¨Ø© Leaflet Ù„Ù„Ø®Ø±ÙŠØ·Ø© -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>





<body>

  <!-- âœ… Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
  <header id="pageHeader" class="fade-in">
    <div style="padding: 20px 10px; text-align: center;">
      <h2 id="landingTitle"></h2>
      <p id="landingDesc"></p>
    </div>
  </header>

  <!-- âœ… ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠØ© -->
  <section>
    <img id="headerImage" src="" alt="Ø¥Ø¹Ù„Ø§Ù† ØªØ±ÙˆÙŠØ¬ÙŠ" width="100%" style="border-radius: 12px;" />
  </section>

  <!-- âœ… ØµÙˆØ± Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ -->
  <section>
    <h2>ğŸ“¸ Ù†ØªØ§Ø¦Ø¬ Ø£Ø¹Ù…Ø§Ù„Ù†Ø§ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h2>
    <div class="before-after">
      <img id="beforeImage" src="" alt="Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ" />
      <img id="afterImage" src="" alt="Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ø¸ÙŠÙ" />
    </div>
  </section>

  <!-- âœ… Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ -->
  <section id="order">
    <h2>ğŸ“ Ù‚Ø¯Ù… Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø¢Ù†</h2>
    <form id="orderForm" class="fade-in">

      <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required />
      <input type="tel" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required />
      <input type="text" id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„" required />

      <label>ğŸ• Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø²ÙŠØ§Ø±Ø©:</label>
      <select id="preferredTime" required>
        <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨</option>
        <option value="ØµØ¨Ø§Ø­Ù‹Ø§">ØµØ¨Ø§Ø­Ù‹Ø§</option>
        <option value="Ù…Ø³Ø§Ø¡Ù‹">Ù…Ø³Ø§Ø¡Ù‹</option>
      </select>

      <label>ğŸ—’ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</label>
      <textarea id="notes" placeholder="Ø§ÙƒØªØ¨ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©..." rows="3"></textarea>

      <label>â„ï¸ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙƒÙŠÙØ§Øª:</label>
      <input type="number" id="acCount" min="1" max="10" value="1" onchange="generateACFields()" required />

      <div id="acContainer"></div>

      <label>ğŸ“¸ ØµÙˆØ±Ø© Ù„Ù„Ù…ÙƒÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
      <input type="file" id="image" accept="image/*" capture="environment" />

      <button type="button" onclick="getLocation()">ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ</button>
      <p id="locationStatus" class="note"></p>
      <div id="map"></div>

      <button type="submit" id="sendBtn">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
    </form>
  </section>

  <!-- âœ… Ø¨Ø§Ù†Ø± Ø³ÙÙ„ÙŠ ØªØ±ÙˆÙŠØ¬ÙŠ -->
  <section>
    <img id="footerImage" src="" alt="ØªÙ†Ø¸ÙŠÙ Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…Ø¶Ù…ÙˆÙ†" width="100%" style="border-radius: 12px;" />
  </section>

  <!-- âœ… Ø§Ù„ÙÙˆØªØ± -->
  <footer id="pageFooter">
    <p id="footerText">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© TopClim 2025</p>
  </footer>

  <!-- âœ… Ø¹Ù†Ø§ØµØ± Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ© -->
  <section style="display: none;" id="futureFeature">
    <h2>ğŸš§ Ù…ÙŠØ²Ø© Ù‚Ø§Ø¯Ù…Ø© Ù‚Ø±ÙŠØ¨Ù‹Ø§</h2>
    <p>Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ©.</p>
  </section>

  <!-- âœ… Ø±Ø³Ø§Ø¦Ù„ ÙÙˆØ±ÙŠØ© (Ø¹Ù†Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø£Ùˆ Ø§Ù„Ø®Ø·Ø£) -->
  <div class="flash-message" id="successMsg">âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!</div>
  <div class="flash-message" id="errorMsg">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨.</div>

  <!-- âœ… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´ÙØ§ÙÙŠØ© -->
  <section>
    <h2>â„¹ï¸ Ù„Ù…Ø§Ø°Ø§ ØªØ®ØªØ§Ø± TopClimØŸ</h2>
    <ul>
      <li>âœ”ï¸ Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ø¶Ø­Ø© Ø¨Ø¯ÙˆÙ† Ø±Ø³ÙˆÙ… Ø®ÙÙŠØ©</li>
      <li>âœ”ï¸ Ø³Ø±Ø¹Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¹Ø§Ù„ÙŠØ© ÙˆØ®Ø¯Ù…Ø© ÙˆØ¯ÙŠØ©</li>
      <li>âœ”ï¸ Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ</li>
      <li>âœ”ï¸ ÙØ±ÙŠÙ‚ Ø°Ùˆ Ø®Ø¨Ø±Ø© ÙˆÙŠØ³ØªØ®Ø¯Ù… Ø£Ø¯ÙˆØ§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ©</li>
    </ul>
  </section>

  <!-- âœ… Ù‚Ø³Ù… Ù„Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª (Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹) -->
  <section style="display: none;" id="reviewsSection">
    <h2>â­ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
    <div id="reviewList">
      <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
    </div>
  </section>


  <script type="module">
// âœ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  collection,
  addDoc,
  serverTimestamp,
  getDocs,
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// âœ… Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBjbzbSd1XM9eyXrgKaVj6xnZgIJuQmbRI",
  authDomain: "topclim-3edfa.firebaseapp.com",
  projectId: "topclim-3edfa",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// âœ… ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ù…Ù† Firebase
let typeOptions = [];
let sizeOptions = [];

async function loadLandingContent() {
  try {
    const docRef = doc(db, "landing", "landingContent");
    const snap = await getDoc(docRef);
    if (snap.exists()) {
      const data = snap.data();
      document.getElementById("headerImage").src = data.bannerTop || "";
      document.getElementById("beforeImage").src = data.beforeImage || "";
      document.getElementById("afterImage").src = data.afterImage || "";
      document.getElementById("footerImage").src = data.bannerBottom || "";
      document.getElementById("landingTitle").textContent = data.headerTitle || "";
      document.getElementById("landingDesc").textContent = data.headerDesc || "";
      document.getElementById("footerText").textContent = data.footerText || "";

      if (data.headerColor) document.getElementById("pageHeader").style.backgroundColor = data.headerColor;
      if (data.footerColor) document.getElementById("pageFooter").style.backgroundColor = data.footerColor;
    }

    const typesSnap = await getDocs(collection(db, "acTypes"));
    const sizesSnap = await getDocs(collection(db, "acSizes"));

    typeOptions = typesSnap.docs.map(doc => `<option value="${doc.data().name}">${doc.data().name}</option>`);
    sizeOptions = sizesSnap.docs.map(doc => `<option value="${doc.data().label}">${doc.data().label}</option>`);

    generateACFields();
  } catch (error) {
    console.error("âš ï¸ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰:", error);
  }
}

loadLandingContent();

// âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙƒÙŠÙØ§Øª
window.generateACFields = function () {
  const count = parseInt(document.getElementById("acCount").value) || 1;
  const container = document.getElementById("acContainer");
  container.innerHTML = "";

  for (let i = 1; i <= count; i++) {
    container.innerHTML += `
      <div class="ac-group">
        <label>ğŸŒ€ Ù†ÙˆØ¹ Ø§Ù„Ù…ÙƒÙŠÙ ${i}</label>
        <select name="type${i}" required>
          <option disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
          ${typeOptions.join("")}
        </select>
        <label>ğŸ“ Ø­Ø¬Ù… Ø§Ù„Ù…ÙƒÙŠÙ ${i}</label>
        <select name="size${i}" required>
          <option disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ø­Ø¬Ù…</option>
          ${sizeOptions.join("")}
        </select>
      </div>
    `;
  }
};

// âœ… Ø¶ØºØ· Ø§Ù„ØµÙˆØ±Ø©
function compressImage(file, quality = 0.6) {
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.onload = (event) => {
      const img = new Image();
      img.src = event.target.result;
      img.onload = () => {
        const canvas = document.createElement("canvas");
        const scale = 800 / img.width;
        canvas.width = 800;
        canvas.height = img.height * scale;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        canvas.toBlob((blob) => {
          resolve(blob);
        }, "image/jpeg", quality);
      };
    };
    reader.readAsDataURL(file);
  });
}

// âœ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
let userLocation = null;

window.getLocation = function () {
  const status = document.getElementById("locationStatus");
  status.textContent = "â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";

  if (!navigator.geolocation) {
    status.textContent = "âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.";
    return;
  }

  navigator.geolocation.getCurrentPosition(
    (position) => {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      const accuracy = position.coords.accuracy;

      userLocation = { lat, lng };
      status.innerHTML = `âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¯Ù‚Ø© ~${Math.round(accuracy)} Ù…ØªØ±`;

      const map = L.map("map").setView([lat, lng], 15);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "Â© OpenStreetMap contributors",
      }).addTo(map);
      L.marker([lat, lng]).addTo(map).bindPopup("ğŸ“ Ù…ÙˆÙ‚Ø¹Ùƒ").openPopup();
    },
    () => {
      status.textContent = "âŒ ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.";
    },
    {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0,
    }
  );
};

// âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("orderForm");
  const imageInput = document.getElementById("image");
  const successMsg = document.getElementById("successMsg");
  const errorMsg = document.getElementById("errorMsg");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const btn = document.getElementById("sendBtn");
    btn.disabled = true;
    btn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const address = document.getElementById("address").value.trim();
    const preferredTime = document.getElementById("preferredTime").value;
    const notes = document.getElementById("notes").value;
    const acCount = parseInt(document.getElementById("acCount").value);

    if (!preferredTime) {
      alert("âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø²ÙŠØ§Ø±Ø©.");
      btn.disabled = false;
      btn.innerText = "ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨";
      return;
    }

    const acUnits = [];
    for (let i = 1; i <= acCount; i++) {
      const type = form.querySelector(`[name=type${i}]`).value;
      const size = form.querySelector(`[name=size${i}]`).value;
      acUnits.push({ type, size });
    }

    let imageUrl = "";
    const imageFile = imageInput.files[0];
    if (imageFile) {
      try {
        const compressedImage = await compressImage(imageFile);
        const formData = new FormData();
        formData.append("file", compressedImage);
        formData.append("upload_preset", "topclim_upload");
        formData.append("folder", "TOPCLIMasset");

        const res = await fetch("https://api.cloudinary.com/v1_1/dtrmfg2om/upload", {
          method: "POST",
          body: formData,
        });

        const data = await res.json();
        imageUrl = data.secure_url;
      } catch (uploadError) {
        console.error("âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©:", uploadError);
        alert("âŒ ØªØ¹Ø°Ø± Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©. Ø¬Ø±Ø¨ Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©.");
        btn.disabled = false;
        btn.innerText = "ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨";
        return;
      }
    }

    try {
      const docRef = await addDoc(collection(db, "requests"), {
        name,
        phone,
        address,
        acCount,
        acUnits,
        preferredTime,
        notes,
        location: userLocation,
        imageUrl,
        status: "Ù…Ø¨Ø¯Ø¦ÙŠ",
        createdAt: serverTimestamp(),
      });

      successMsg.style.display = "block";
      setTimeout(() => {
        successMsg.style.display = "none";
        window.location.href = `track.html?id=${docRef.id}`;
      }, 2000);
    } catch (err) {
      console.error("âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨:", err);
      errorMsg.style.display = "block";
      setTimeout(() => {
        errorMsg.style.display = "none";
      }, 3000);
    }

    btn.disabled = false;
    btn.innerText = "ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨";
  });
});
</script>

</body>
</html>